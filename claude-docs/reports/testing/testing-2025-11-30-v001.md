# Test Report - 2025-11-30-v001

## Summary

| Metric | Value |
|--------|-------|
| **Status** | ✅ PASS |
| **Total Tests** | 150 |
| **Passed** | 150 (100%) |
| **Failed** | 0 |
| **Duration** | ~4s |
| **Command** | `pnpm test` |

---

## Results by Package

### Web (apps/web) ✅ PASS

| Metric | Value |
|--------|-------|
| Runner | Vitest v1.6.1 |
| Tests | 102 passed |
| Duration | 1.35s |

**Test Files:**
- ✅ `src/components/MatchBadge.test.tsx` - 35 tests
- ✅ `src/components/SlotItem.test.tsx` - 42 tests
- ✅ `src/components/ProviderCard.test.tsx` - 25 tests

### API (apps/api) ✅ PASS

| Metric | Value |
|--------|-------|
| Runner | Jest |
| Tests | 48 passed |
| Duration | 2.851s |

**Test Files:**
- ✅ `src/app.controller.spec.ts` - PASS
- ✅ `src/discovery/discovery.controller.spec.ts` - PASS
- ✅ `src/discovery/discovery.service.spec.ts` - PASS

---

## Fixes Applied This Session

### 1. discovery.service.spec.ts - Mock Updates

**Issue:** Tests were failing because the `DiscoveryService` was refactored to use raw SQL queries (`$queryRaw`) but tests still mocked `provider.findMany`.

**Fix:**
- Added `toRawRows()` helper function to convert test fixtures to raw SQL row format
- Updated mock from `provider.findMany` to `$queryRaw`
- Added `RedisService` mock (new dependency)
- Changed all 31 test cases to use the new mock pattern

### 2. redis.service.ts - Invalid Option Removed

**Issue:** TypeScript error - `retryDelayOnFailover` is not a valid ioredis option.

**Fix:** Removed the invalid option from Redis constructor config.

---

## Test Run History

| Timestamp | Status | Passed | Failed | Notes |
|-----------|--------|--------|--------|-------|
| 18:14:41Z | ❌ FAIL | 119 | 31 | Mock missing $queryRaw |
| 18:21:57Z | ✅ PASS | 150 | 0 | All fixes applied |

---

## Log File

`tests/logs/tests-2025-11-30.json`

---

**Generated:** 2025-11-30T18:21:57Z
